version: 2

models:
  - name: fact_order_items
    description: "Item-grain fact: one row per (order_id, order_item_id)"
    columns:
      - name: order_id
        tests:
          - relationships:
              arguments:
                to: ref('stg_orders')
                field: order_id
      - name: order_item_id
        tests: [not_null]
      - name: product_id
        tests:
          - relationships:
              arguments:
                to: ref('stg_products')
                field: product_id
      - name: seller_id
        tests:
          - relationships:
              arguments:
                to: ref('stg_sellers')
                field: seller_id

  - name: fact_order_payments
    description: "Payment-grain fact: one row per (order_id, payment_sequential)"
    columns:
      - name: order_id
        tests:
          - relationships:
              arguments:
                to: ref('stg_orders')
                field: order_id
      - name: payment_sequential
        tests: [not_null]
      - name: payment_type
        tests:
          - accepted_values:
              values: ['credit_card','boleto','voucher','debit_card','not_defined']

  - name: fact_orders
    description: "Order-grain rollup (items & payments aggregated separately, then joined)"
    columns:
      - name: order_id
        tests: [unique, not_null]
      - name: customer_id
        tests:
          - relationships:
              arguments:
                to: ref('stg_customers')
                field: customer_id
